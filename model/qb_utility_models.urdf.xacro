<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

	<xacro:include filename="$(find qbmove_description)/model/qbmove.urdf.xacro" />

	<xacro:property name="c_flange" value="91" />
	<xacro:property name="c2_flange" value="120" />
	<xacro:property name="flange_mass" value="0.1" />
	<xacro:property name="c_flange_com_z" value="48" />
	<xacro:property name="c2_flange_com_z" value="72" />
	<xacro:property name="mp_cube_mass" value="0.25" />


	<!-- a macro for non-actuated qb cubes -->
	<xacro:macro name="qb_empty" params="parent name position orientation">
		<joint name="${name}_dummy_joint" type="fixed">
			<origin xyz="${position}" rpy="${orientation}" />
			<parent link="${parent}"/>
			<child link="${name}"/>
		</joint>

		<link name="${name}">
			<inertial>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<mass value="${cube_mass}"/>
				<inertia ixx="${cube_mass * cube_size * cube_size /9.0 * mm2_to_m2}" ixy="0.0" ixz="0.0" iyy="${cube_mass * cube_size * cube_size /9.0 * mm2_to_m2}" iyz="0.0" izz="${cube_mass * cube_size * cube_size /9.0 * mm2_to_m2}"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
					<!-- box size="${cube_size/scale_f} ${cube_size/scale_f} ${cube_size/scale_f}"/-->
					<mesh filename="package://qbmove_description/meshes/cube.stl" />
				</geometry>
			<material name="QB/Blue" />
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0"/>
			  <geometry>
				<box size="${cube_size/scale_f} ${cube_size/scale_f} ${cube_size/scale_f}"/>
			  </geometry>
			</collision>
		</link>
	</xacro:macro>

	<!-- a macro for inversely-mounted qb cubes : NOTE that this are MAKER PRO cubes, NOT advanced -->
	<xacro:macro name="qb_move_reverse" params="parent name position orientation">
		<joint name="${name}_joint" type="revolute">
			<origin xyz="${position}" rpy="${orientation}" />
			<parent link="${parent}"/>
			<child link="${name}"/>
			<axis xyz="0 0 1" />
			<dynamics damping="${damping_all}" />
			<limit lower="${low_b * pi / 180}" upper="${up_b * pi / 180}" effort="${effort}" velocity="${velocity}"/>
		</joint>

		<link name="${name}">
			<inertial>
				<!-- inertia of a full, uniform cube -->
				<origin xyz="0 0 0" rpy="0 0 0" />
				<mass value="${mp_cube_mass}"/>
				<inertia ixx="${mp_cube_mass * cube_size * cube_size / 6.0 * mm2_to_m2}" ixy="0.0" ixz="0.0" iyy="${mp_cube_mass * cube_size * cube_size / 6.0 * mm2_to_m2}" iyz="0.0" izz="${mp_cube_mass * cube_size * cube_size / 6.0 * mm2_to_m2}"/>
			</inertial>
			<visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
					<!-- box size="${cube_size/scale_f} ${cube_size/scale_f} ${cube_size/scale_f}"/-->
					<mesh filename="package://qbmove_description/meshes/cube.stl" />
				</geometry>
			<material name="QB/Blue" />
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0"/>
			  <geometry>
				<box size="${cube_size/scale_f} ${cube_size/scale_f} ${cube_size/scale_f}"/>
			  </geometry>
			</collision>
		</link>
	</xacro:macro>

	<xacro:macro name="rotating_c_shaft" params="parent name position orientation">
		<joint name="${name}_fixed_joint" type="fixed">
			<origin xyz="${position}" rpy="${orientation}" />
			<parent link="${parent}"/>
			<child link="${name}_link"/>
		</joint>

		<link name="${name}_link">
			<inertial>
				<origin xyz="0 0 ${-(c_flange_com_z)/scale_f}" rpy="0 0 0" />
				<mass value="${flange_mass}"/>
				<inertia ixx="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" ixy="0.0" ixz="0.0" iyy="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" iyz="0.0" izz="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}"/>
			</inertial>
			<visual>
				<origin xyz="0 ${cube_size/scale_f/2.0} ${-c_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c_flange/scale_f/10.0} ${c_flange/scale_f}"/>
				</geometry>
			</visual>
			<visual>
				<origin xyz="0 ${-cube_size/scale_f/2.0} ${-c_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c_flange/scale_f/10.0} ${c_flange/scale_f}"/>
				</geometry>
			</visual>
		</link>

		<joint name="${name}_fixed_joint2" type="fixed">
			<origin xyz="0 0 ${-c_flange/scale_f}" rpy="0 0 0" />
			<parent link="${name}_link"/>
			<child link="${name}"/>
		</joint>

		<link name="${name}"/>
	</xacro:macro>

	<!-- this just differs from the above one because of the CoM position (and mesh, if it will be added) -->
	<xacro:macro name="fixed_c_shaft" params="parent name position orientation">
		<joint name="${name}_fixed_joint" type="fixed">
			<origin xyz="${position}" rpy="${orientation}" />
			<parent link="${parent}"/>
			<child link="${name}_link"/>
		</joint>

		<link name="${name}_link">
			<inertial>
				<origin xyz="0 0 ${(-c_flange+c_flange_com_z)/scale_f}" rpy="0 0 0" />
				<mass value="${flange_mass}"/>
				<inertia ixx="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" ixy="0.0" ixz="0.0" iyy="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" iyz="0.0" izz="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}"/>
			</inertial>
			<visual>
				<origin xyz="0 ${cube_size/scale_f/2.0} ${-c_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c_flange/scale_f/10.0} ${c_flange/scale_f}"/>
				</geometry>
			</visual>
			<visual>
				<origin xyz="0 ${-cube_size/scale_f/2.0} ${-c_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c_flange/scale_f/10.0} ${c_flange/scale_f}"/>
				</geometry>
			</visual>
		</link>

		<joint name="${name}_fixed_joint2" type="fixed">
			<origin xyz="0 0 ${-c_flange/scale_f}" rpy="0 0 0" />
			<parent link="${name}_link"/>
			<child link="${name}"/>
		</joint>

		<link name="${name}"/>
	</xacro:macro>

	<xacro:macro name="rotating_c2_shaft" params="parent name position orientation">
		<joint name="${name}_fixed_joint" type="fixed">
			<origin xyz="${position}" rpy="${orientation}" />
			<parent link="${parent}"/>
			<child link="${name}_link"/>
		</joint>

		<link name="${name}_link">
			<inertial>
				<origin xyz="0 0 ${-(c2_flange_com_z)/scale_f}" rpy="0 0 0" />
				<mass value="${flange_mass}"/>
				<inertia ixx="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" ixy="0.0" ixz="0.0" iyy="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}" iyz="0.0" izz="${flange_mass * cube_size * cube_size /9.0 * mm2_to_m2}"/>
			</inertial>
			<visual>
				<origin xyz="0 ${cube_size/scale_f/2.0} ${-c2_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c2_flange/scale_f/10.0} ${c2_flange/scale_f}"/>
				</geometry>
			</visual>
			<visual>
				<origin xyz="0 ${-cube_size/scale_f/2.0} ${-c2_flange/scale_f/2.0}" rpy="0 0 0" />
				<geometry>
					<box size="${cube_size/scale_f/2.0} ${c2_flange/scale_f/10.0} ${c2_flange/scale_f}"/>
				</geometry>
			</visual>
		</link>

		<joint name="${name}_fixed_joint2" type="fixed">
			<origin xyz="0 0 ${-c2_flange/scale_f}" rpy="0 0 0" />
			<parent link="${name}_link"/>
			<child link="${name}"/>
		</joint>

		<link name="${name}"/>
	</xacro:macro>

</robot>
